{% extends 'base.html.twig' %}

{# Translation domain #}
{% trans_default_domain 'messages' %}

{# Set default image using asset() to generate absolute URL #}
{% set logo = sys_pref('theme.login_image_path') ?: asset('images/logo.svg') %}

{% block stylesheets %}
    <link class="exe" rel="stylesheet" href="{{ asset('libs/bootstrap/bootstrap.min.css') }}">
    <link class="exe" rel="stylesheet" href="{{ asset('style/workarea/main.css') }}">
{% endblock %}

{% block class %}login-page{% endblock %}
{% block title %}eXeLearning{% endblock %}

{% block body %}
<section id="login-tpl" role="main">
    <div class="login-left">
        <div class="card-body text-black">
            <img src="{{logo}}" alt="" class="logo mb-3">
                <div id="exe-version" class="small">
                    <span class="visually-hidden">{{ 'Version:'|trans({}, 'messages') }}</span>
                    {{ app_version }}
                </div>
                <h1 class="sign-in">{{ "Sign in" | trans }}</h3>
                <p class="hello-again">{{ "Hello again! Please enter your credentials." | trans }}</p>
                {% if error %}
                    <div class="alert alert-danger alert-dismissible fade show mb-4" role="alert">
                    {{ error.messageKey|trans(error.messageData, 'messages') }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="{{ 'Close' | trans }}"></button>
                    </div>
                {% endif %}
                {% if app.user %}
                    <div class="text-center text-md-start">
                    <p class="mb-4">{{ 'Logged in as' | trans }} <strong>{{ app.user.username }}</strong></p>
                    <a href="{{ path('app_logout') }}" class="btn button-primary logout-button">{{ 'Logout' | trans }}</a>
                    </div>
                {% else %}
                    {% if '-' in app_version %}
                    <!--p class="alert alert-warning mb-3">{{ "This is just a demo version. Not for real projects." | trans }}</p-->
                    {% endif %}
                    {% if 'password' in auth_methods %}
                    <form id="login-form" name="login" action="{{ path('app_login_check') }}" method="post" data-turbo="false">
                        <h2 class="visually-hidden">{{ 'Sign in' | trans }}</h2>
                        <input type="hidden" name="_csrf_token" data-controller="csrf-protection" value="{{ csrf_token('authenticate') }}">
                        <div class="login-user">
                            <label for="inputEmail">{{ 'Email' | trans }}</label>
                            <input type="email" id="inputEmail" class="form-control mb-2" name="email" value="{{ last_username }}" placeholder="{{ 'Email' | trans }}" required>
                        </div>
                        <div class="login-password">
                            <label for="inputPassword">{{ 'Password' | trans }}</label>
                            <input type="password" class="form-control" id="inputPassword" name="password" placeholder="{{ 'Password' | trans }}" required>
                        </div>
                        <button class="login-submit btn button-primary btn-lg btn-block w-100" id="login-form-btn-submit" name="btn-submit" type="submit">{{ 'Sign in' | trans }}</button>
                    </form>
                    {% endif %}

                    {% if 'cas' in auth_methods or 'openid' in auth_methods or 'guest' in auth_methods %}
                    {# Additional login method buttons #}
                    <div class="other-methods">
                        {% if 'password' in auth_methods %}
                        <p class="small text-center">{{ 'Other authentication methods:' | trans }}</p>
                        {% else %}
                        <p class="small text-center">{{ 'Authentication methods:' | trans }}</p>
                        {% endif %}
                        <div class="other-methods-buttons d-flex justify-content-center align-items-center g-5">
                        {# Important!: Disable @hotwired on links with data-turbo="false" to avoid prefetching the login pages #}
                        {% if 'cas' in auth_methods %}
                            <a href="{{ path('cas_login') }}" id="login-link-cas" rel="nofollow noreferrer" class="btn btn-secondary d-flex justify-content-center align-items-center mx-1" data-turbo="false" data-no-prefetch>CAS</a>
                        {% endif %}
                        {% if 'openid' in auth_methods %}
                            <a href="{{ path('openid_connect') }}" id="login-link-openid" rel="nofollow noreferrer" class="btn btn-secondary d-flex justify-content-center align-items-center mx-1" data-turbo="false" data-no-prefetch>OpenID</a>
                        {% endif %}
                        {% if 'guest' in auth_methods %}
                            <a href="{{ path('guest_login') }}" id="login-link-guest" rel="nofollow noreferrer" class="btn btn-secondary d-flex justify-content-center align-items-center mx-1" data-turbo="false" data-no-prefetch>{{ 'Guest' | trans }}</a>
                        {% endif %}
                        </div>
                    </div>
                    {% endif %}
            {% endif %}
        </div>
    </div>
    <div class="login-right"></div>
</section>
<script class="exe" src="{{ asset('libs/bootstrap/bootstrap.bundle.min.js') }}" defer></script>
{% endblock %}
